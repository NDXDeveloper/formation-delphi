üîù Retour au [Sommaire](/SOMMAIRE.md)

# 3.3.1 L'op√©rateur ternaire en Delphi 13

## Introduction

L'une des nouveaut√©s les plus attendues de **Delphi 13 Florence** est l'introduction de l'**op√©rateur ternaire**, √©galement appel√© **op√©rateur conditionnel**. Cette fonctionnalit√©, pr√©sente dans de nombreux langages de programmation modernes (C, Java, JavaScript, C#, Python, etc.), permet d'√©crire des expressions conditionnelles de mani√®re plus concise et √©l√©gante.

## Qu'est-ce qu'un op√©rateur ternaire ?

L'op√©rateur ternaire est appel√© ainsi car il prend **trois op√©randes** :
1. Une **condition** √† √©valuer
2. Une **valeur** √† retourner si la condition est vraie
3. Une **valeur** √† retourner si la condition est fausse

C'est une forme compacte de l'instruction `if...then...else` qui retourne directement une valeur.

## Syntaxe en Delphi 13

La syntaxe de l'op√©rateur ternaire en Object Pascal est la suivante :

```pascal
variable := if condition then valeur_si_vrai else valeur_si_faux;
```

**D√©composition :**
- `if` : mot-cl√© introduisant la condition
- `condition` : expression bool√©enne √† √©valuer
- `then` : mot-cl√© s√©parant la condition de la premi√®re valeur
- `valeur_si_vrai` : valeur retourn√©e si la condition est `True`
- `else` : mot-cl√© s√©parant les deux valeurs
- `valeur_si_faux` : valeur retourn√©e si la condition est `False`

## Comparaison avec l'approche traditionnelle

### Approche traditionnelle (avant Delphi 13)

```pascal
var
  Age: Integer;
  Statut: string;
begin
  Age := 20;

  if Age >= 18 then
    Statut := 'Majeur'
  else
    Statut := 'Mineur';

  ShowMessage('Statut : ' + Statut);
end;
```

### Avec l'op√©rateur ternaire (Delphi 13)

```pascal
var
  Age: Integer;
  Statut: string;
begin
  Age := 20;

  Statut := if Age >= 18 then 'Majeur' else 'Mineur';

  ShowMessage('Statut : ' + Statut);
end;
```

**Avantages :**
- Code plus compact : 1 ligne au lieu de 4
- Lecture plus fluide pour des conditions simples
- Moins de r√©p√©tition du nom de variable

## Exemples pratiques pour d√©butants

### Exemple 1 : D√©terminer un texte selon une condition

```pascal
var
  Temperature: Integer;
  Conseil: string;
begin
  Temperature := 25;

  // Op√©rateur ternaire
  Conseil := if Temperature > 30 then 'Il fait chaud !' else 'Temp√©rature agr√©able';

  ShowMessage(Conseil);
end;
```

### Exemple 2 : Calcul avec condition

```pascal
var
  Quantite: Integer;
  PrixUnitaire: Double;
  Remise: Double;
  PrixTotal: Double;
begin
  Quantite := 15;
  PrixUnitaire := 10.0;

  // Appliquer une remise de 10% si quantit√© >= 10
  Remise := if Quantite >= 10 then 0.10 else 0.0;

  PrixTotal := Quantite * PrixUnitaire * (1 - Remise);

  ShowMessage('Prix total : ' + FormatFloat('0.00 ‚Ç¨', PrixTotal));
end;
```

### Exemple 3 : Validation de donn√©es

```pascal
var
  NomUtilisateur: string;
  Message: string;
begin
  NomUtilisateur := Edit1.Text;

  // V√©rifier si le nom est renseign√©
  Message := if NomUtilisateur <> ''
             then 'Bienvenue ' + NomUtilisateur
             else 'Veuillez entrer votre nom';

  ShowMessage(Message);
end;
```

### Exemple 4 : Affichage de nombres au singulier/pluriel

```pascal
var
  NombreFichiers: Integer;
  TexteAffichage: string;
begin
  NombreFichiers := 5;

  TexteAffichage := IntToStr(NombreFichiers) +
                    if NombreFichiers > 1 then ' fichiers' else ' fichier';

  ShowMessage(TexteAffichage);  // Affiche : "5 fichiers"
end;
```

### Exemple 5 : Activation de composants visuels

```pascal
procedure TForm1.Edit1Change(Sender: TObject);
begin
  // Activer le bouton uniquement si le champ contient du texte
  Button1.Enabled := if Edit1.Text <> '' then True else False;

  // Version simplifi√©e (la condition retourne d√©j√† un bool√©en)
  Button1.Enabled := Edit1.Text <> '';
end;
```

### Exemple 6 : Choix de couleur selon un √©tat

```pascal
var
  Erreur: Boolean;
  Score: Integer;
begin
  Erreur := False;
  Score := 85;

  // Couleur du panneau selon l'√©tat
  Panel1.Color := if Erreur then clRed else clGreen;

  // Couleur selon le score
  Label1.Font.Color := if Score >= 50 then clGreen else clRed;
end;
```

## Op√©rateurs ternaires imbriqu√©s

L'op√©rateur ternaire peut √™tre imbriqu√© pour g√©rer plusieurs conditions. Cependant, il faut l'utiliser avec prudence pour ne pas nuire √† la lisibilit√©.

### Exemple : Syst√®me de notation

```pascal
var
  Note: Integer;
  Mention: string;
begin
  Note := 15;

  Mention := if Note >= 16 then 'Tr√®s bien'
             else if Note >= 14 then 'Bien'
             else if Note >= 12 then 'Assez bien'
             else if Note >= 10 then 'Passable'
             else 'Insuffisant';

  ShowMessage('Mention obtenue : ' + Mention);
end;
```

### Exemple : Tarification par tranches

```pascal
var
  Age: Integer;
  Tarif: Double;
begin
  Age := 25;

  Tarif := if Age < 12 then 5.0
           else if Age < 18 then 8.0
           else if Age < 65 then 12.0
           else 9.0;

  ShowMessage('Tarif : ' + FormatFloat('0.00 ‚Ç¨', Tarif));
end;
```

**Note :** Au-del√† de 2-3 niveaux d'imbrication, il est pr√©f√©rable d'utiliser une structure `case...of` ou des `if...else if` traditionnels pour maintenir la lisibilit√©.

## Utilisation dans des expressions complexes

### Dans des calculs math√©matiques

```pascal
var
  X, Y: Integer;
  Max: Integer;
begin
  X := 10;
  Y := 20;

  // Trouver le maximum entre deux nombres
  Max := if X > Y then X else Y;

  ShowMessage('Le maximum est : ' + IntToStr(Max));
end;
```

### Dans des appels de fonctions

```pascal
var
  Utilisateur: string;
begin
  Utilisateur := 'Admin';

  // Passer une valeur conditionnelle √† une fonction
  ShowMessage(if Utilisateur = 'Admin' then 'Acc√®s total' else 'Acc√®s limit√©');
end;
```

### Dans des initialisations d'objets

```pascal
procedure TForm1.FormCreate(Sender: TObject);
var
  ModeSombre: Boolean;
begin
  ModeSombre := True;

  // D√©finir la couleur de fond selon le mode
  Self.Color := if ModeSombre then clBlack else clWhite;

  // D√©finir la couleur du texte
  Label1.Font.Color := if ModeSombre then clWhite else clBlack;
end;
```

## Combinaison avec d'autres op√©rateurs

### Avec des op√©rateurs logiques

```pascal
var
  Age: Integer;
  APermis: Boolean;
  PeutConduire: string;
begin
  Age := 20;
  APermis := True;

  PeutConduire := if (Age >= 18) and APermis
                  then 'Peut conduire'
                  else 'Ne peut pas conduire';

  ShowMessage(PeutConduire);
end;
```

### Avec des op√©rateurs arithm√©tiques

```pascal
var
  Nombre: Integer;
  Resultat: Integer;
begin
  Nombre := 7;

  // Doubler si pair, tripler si impair
  Resultat := Nombre * (if Nombre mod 2 = 0 then 2 else 3);

  ShowMessage('R√©sultat : ' + IntToStr(Resultat));
end;
```

### Avec la concat√©nation de cha√Ænes

```pascal
var
  Prenom: string;
  Titre: string;
  Message: string;
begin
  Prenom := 'Marie';
  Titre := 'Mme';

  Message := 'Bonjour ' +
             if Titre <> '' then Titre + ' ' else '' +
             Prenom;

  ShowMessage(Message);  // Affiche : "Bonjour Mme Marie"
end;
```

## Cas d'usage avanc√©s

### Valeurs par d√©faut

```pascal
function ObtenirNomAffichage(const Nom, Prenom: string): string;
begin
  Result := if (Prenom <> '') and (Nom <> '')
            then Prenom + ' ' + Nom
            else if Nom <> ''
            then Nom
            else 'Utilisateur inconnu';
end;
```

### Gestion de configurations

```pascal
const
  MODE_DEBUG = True;

var
  NiveauLog: string;
  CheminFichier: string;
begin
  NiveauLog := if MODE_DEBUG then 'D√©taill√©' else 'Erreurs uniquement';
  CheminFichier := if MODE_DEBUG then 'C:\Logs\debug.log' else 'C:\Logs\prod.log';
end;
```

### Formatage conditionnel

```pascal
var
  Montant: Double;
  TexteFormate: string;
begin
  Montant := -150.75;

  TexteFormate := if Montant >= 0
                  then FormatFloat('+0.00 ‚Ç¨', Montant)
                  else FormatFloat('0.00 ‚Ç¨', Montant);

  ShowMessage('Montant : ' + TexteFormate);
end;
```

## Quand utiliser l'op√©rateur ternaire ?

### ‚úÖ Situations id√©ales pour l'op√©rateur ternaire

1. **Affectations simples bas√©es sur une condition**
   ```pascal
   Couleur := if Actif then clGreen else clGray;
   ```

2. **Choix entre deux valeurs litt√©rales**
   ```pascal
   Message := if Erreur then '√âchec' else 'Succ√®s';
   ```

3. **Valeurs par d√©faut**
   ```pascal
   Nom := if Edit1.Text <> '' then Edit1.Text else 'Anonyme';
   ```

4. **Conditions courtes et √©videntes**
   ```pascal
   Signe := if Nombre > 0 then '+' else '-';
   ```

5. **Param√®tres conditionnels dans des appels de fonction**
   ```pascal
   Resultat := CalculerPrix(Quantite, if Client.Premium then 0.15 else 0);
   ```

### ‚ùå Situations o√π il vaut mieux √©viter l'op√©rateur ternaire

1. **Logique complexe avec plusieurs conditions imbriqu√©es**
   ```pascal
   // ‚ùå Difficile √† lire
   Result := if (A > 0) and (B > 0) then if C > 0 then 1 else 2 else if D > 0 then 3 else 4;

   // ‚úÖ Plus clair avec if...else
   if (A > 0) and (B > 0) then
   begin
     if C > 0 then
       Result := 1
     else
       Result := 2;
   end
   else if D > 0 then
     Result := 3
   else
     Result := 4;
   ```

2. **Quand des actions multiples sont n√©cessaires**
   ```pascal
   // ‚ùå Impossible avec l'op√©rateur ternaire
   if Condition then
   begin
     Action1;
     Action2;
     Action3;
   end
   else
   begin
     AutreAction1;
     AutreAction2;
   end;
   ```

3. **Quand la lisibilit√© est compromise**
   ```pascal
   // ‚ùå Trop complexe
   X := if ((A > B) and (C < D)) or ((E = F) and (G <> H)) then Val1 else Val2;

   // ‚úÖ Plus lisible
   EstConditionVraie := ((A > B) and (C < D)) or ((E = F) and (G <> H));
   X := if EstConditionVraie then Val1 else Val2;
   ```

## Comparaison avec d'autres langages

Pour les d√©veloppeurs venant d'autres langages, voici comment l'op√©rateur ternaire de Delphi se compare :

### C/C++/Java/JavaScript
```c
// Syntaxe : condition ? valeur_si_vrai : valeur_si_faux
statut = (age >= 18) ? "Majeur" : "Mineur";
```

### C#
```csharp
// Syntaxe : condition ? valeur_si_vrai : valeur_si_faux
string statut = (age >= 18) ? "Majeur" : "Mineur";
```

### Python
```python
# Syntaxe : valeur_si_vrai if condition else valeur_si_faux
statut = "Majeur" if age >= 18 else "Mineur"
```

### Delphi 13
```pascal
// Syntaxe : if condition then valeur_si_vrai else valeur_si_faux
Statut := if Age >= 18 then 'Majeur' else 'Mineur';
```

**Particularit√© de Delphi :** La syntaxe utilise les mots-cl√©s `if...then...else` familiers, ce qui rend l'op√©rateur ternaire plus naturel pour les d√©veloppeurs Object Pascal.

## Diff√©rences avec le if...then...else classique

### Op√©rateur ternaire (expression)
```pascal
// Retourne une VALEUR
Statut := if Age >= 18 then 'Majeur' else 'Mineur';
```

### if...then...else classique (instruction)
```pascal
// Ex√©cute des INSTRUCTIONS
if Age >= 18 then
  Statut := 'Majeur'
else
  Statut := 'Mineur';
```

**Diff√©rence cl√© :** L'op√©rateur ternaire est une **expression** qui produit une valeur, tandis que `if...then...else` est une **instruction** qui ex√©cute du code.

## Performances

L'op√©rateur ternaire a les m√™mes performances qu'un `if...then...else` classique. Le compilateur g√©n√®re un code machine √©quivalent dans les deux cas.

```pascal
// Ces deux versions ont exactement les m√™mes performances
X := if Condition then 10 else 20;

if Condition then
  X := 10
else
  X := 20;
```

**Conclusion :** Choisissez l'op√©rateur ternaire pour la **lisibilit√©** et la **concision**, pas pour les performances.

## Bonnes pratiques

### 1. Garder les expressions simples

```pascal
// ‚úÖ Bon : simple et clair
Message := if EstConnecte then 'En ligne' else 'Hors ligne';

// ‚ùå √âviter : trop complexe
Message := if (EstConnecte and (HeureConnexion > 0) and (not EstSuspendu))
           then 'Utilisateur actif'
           else 'Utilisateur inactif';
```

### 2. Utiliser des parenth√®ses pour la clart√©

```pascal
// ‚úÖ Clair avec parenth√®ses
Resultat := (if X > 0 then X else -X) * 2;

// ‚ùå Peut pr√™ter √† confusion
Resultat := if X > 0 then X else -X * 2;
```

### 3. Aligner les valeurs pour les expressions longues

```pascal
// ‚úÖ Bien format√©
Message := if Utilisateur.EstAdmin
           then 'Acc√®s administrateur accord√©'
           else 'Acc√®s utilisateur standard';
```

### 4. Ne pas forcer l'utilisation

```pascal
// ‚ùå Forc√© et moins lisible
Button1.Enabled := if Edit1.Text <> '' then True else False;

// ‚úÖ Plus simple et direct
Button1.Enabled := Edit1.Text <> '';
```

### 5. Commenter les conditions complexes

```pascal
// ‚úÖ Commentaire utile pour une logique m√©tier
Tarif := if Age < 18 then 8.0 else 12.0;  // Tarif r√©duit pour les mineurs
```

## Erreurs courantes √† √©viter

### Erreur 1 : Oublier le else

```pascal
// ‚ùå ERREUR : le else est obligatoire
X := if Condition then 10;  // Erreur de compilation

// ‚úÖ CORRECT
X := if Condition then 10 else 0;
```

### Erreur 2 : Types incompatibles

```pascal
// ‚ùå ERREUR : types diff√©rents
X := if Condition then 10 else 'Texte';  // Erreur de type

// ‚úÖ CORRECT : types compatibles
X := if Condition then 10 else 20;
```

### Erreur 3 : Utiliser pour ex√©cuter des actions

```pascal
// ‚ùå ERREUR : impossible d'ex√©cuter des proc√©dures
Result := if Condition then ShowMessage('Test') else ShowMessage('Test2');

// ‚úÖ CORRECT : utiliser if...then...else classique
if Condition then
  ShowMessage('Test')
else
  ShowMessage('Test2');
```

### Erreur 4 : Trop d'imbrication

```pascal
// ‚ùå Difficile √† lire
X := if A then if B then if C then 1 else 2 else 3 else 4;

// ‚úÖ Utiliser case...of ou if...else classique
```

## Exemples r√©els d'application

### Interface utilisateur responsive

```pascal
procedure TForm1.FormResize(Sender: TObject);
begin
  // Adapter la taille de police selon la largeur
  Label1.Font.Size := if Width > 800 then 14 else 10;

  // Afficher/masquer des panneaux
  Panel1.Visible := if Width > 600 then True else False;
end;
```

### Validation de formulaire

```pascal
function ValiderFormulaire: Boolean;
var
  MessageErreur: string;
begin
  MessageErreur := if Edit1.Text = '' then 'Le nom est obligatoire'
                   else if Edit2.Text = '' then 'L''email est obligatoire'
                   else if Edit3.Text = '' then 'Le t√©l√©phone est obligatoire'
                   else '';

  Result := MessageErreur = '';

  if not Result then
    ShowMessage(MessageErreur);
end;
```

### Formatage de donn√©es

```pascal
function FormaterDuree(Secondes: Integer): string;
var
  Heures, Minutes: Integer;
begin
  Heures := Secondes div 3600;
  Minutes := (Secondes mod 3600) div 60;

  Result := if Heures > 0 then Format('%d h %d min', [Heures, Minutes])
            else if Minutes > 0 then Format('%d min', [Minutes])
            else Format('%d sec', [Secondes]);
end;
```

## Points cl√©s √† retenir

1. **Nouveaut√© de Delphi 13** : L'op√©rateur ternaire est une addition majeure au langage
2. **Syntaxe** : `if condition then valeur1 else valeur2`
3. **Usage** : Id√©al pour les affectations conditionnelles simples
4. **Lisibilit√©** : Privil√©gier la clart√© sur la concision
5. **Limitation** : Le `else` est obligatoire (contrairement au if classique)
6. **Types** : Les deux valeurs doivent √™tre de types compatibles
7. **Expression** : Retourne une valeur, ne peut pas ex√©cuter des instructions
8. **Performance** : √âquivalent √† un if...then...else classique

## Conseil final

L'op√©rateur ternaire est un outil puissant qui am√©liore la concision et la modernit√© du code Delphi. Cependant, comme tout outil, il doit √™tre utilis√© √† bon escient. La r√®gle d'or est simple : **si votre op√©rateur ternaire est difficile √† lire en une seule lecture, utilisez un if...then...else classique**.

---

L'op√©rateur ternaire de Delphi 13 rapproche le langage des standards modernes tout en conservant la syntaxe famili√®re d'Object Pascal. C'est une √©volution bienvenue qui modernise l'√©criture du code sans sacrifier la lisibilit√© qui fait la force de Delphi.

‚è≠Ô∏è [Structures de contr√¥le (conditions, boucles)](/03-langage-object-pascal/04-structures-de-controle.md)
