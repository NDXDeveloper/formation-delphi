🔝 Retour au [Sommaire](/SOMMAIRE.md)

# 4.3.4 Listes et grilles

## Introduction

Lorsque vous devez afficher des **collections de données** dans votre application, les composants de listes et de grilles sont indispensables. Que ce soit pour afficher une liste de clients, un tableau de produits, ou une grille de données, ces composants vous permettent de présenter l'information de manière structurée et interactive.

Dans cette section, nous allons explorer les principaux composants de listes et grilles de la VCL :
- **TListBox** : Liste simple d'éléments
- **TCheckListBox** : Liste avec cases à cocher
- **TStringGrid** : Grille de texte
- **TListView** : Liste avancée avec colonnes et différentes vues

Ces composants sont essentiels pour créer des interfaces riches permettant à l'utilisateur de visualiser et sélectionner des données.

## Le composant TListBox (Liste simple)

### Qu'est-ce qu'un TListBox ?

**TListBox** affiche une **liste verticale d'éléments** parmi lesquels l'utilisateur peut sélectionner. C'est l'un des composants les plus simples et les plus utilisés pour afficher des listes.

**Utilisations courantes :**
- Afficher une liste de noms, de produits, de catégories
- Permettre la sélection d'un ou plusieurs éléments
- Afficher des résultats de recherche
- Liste de fichiers ou dossiers
- Navigation dans des options

### Où trouver TListBox ?

TListBox se trouve dans l'onglet **Standard** de la palette de composants.

### Propriétés essentielles de TListBox

#### 1. Items - Le contenu de la liste

C'est une collection (TStrings) contenant tous les éléments de la liste :

```pascal
// Ajouter un élément
ListBox1.Items.Add('Élément 1');
ListBox1.Items.Add('Élément 2');

// Ajouter plusieurs éléments
ListBox1.Items.AddStrings(['Rouge', 'Vert', 'Bleu', 'Jaune']);

// Insérer un élément à une position
ListBox1.Items.Insert(0, 'Premier élément');

// Supprimer un élément par index
ListBox1.Items.Delete(0);

// Supprimer un élément par valeur
ListBox1.Items.Delete(ListBox1.Items.IndexOf('Rouge'));

// Effacer tous les éléments
ListBox1.Items.Clear;

// Nombre d'éléments
NombreElements := ListBox1.Items.Count;

// Accéder à un élément
PremierElement := ListBox1.Items[0];
```

**Remplir Items au moment de la conception :**
Dans l'Inspecteur d'objets, double-cliquez sur Items pour ouvrir l'éditeur de liste.

#### 2. ItemIndex - L'élément sélectionné

Indique quel élément est actuellement sélectionné :

```pascal
// Sélectionner le premier élément (index 0)
ListBox1.ItemIndex := 0;

// Sélectionner le troisième élément
ListBox1.ItemIndex := 2;

// Aucune sélection
ListBox1.ItemIndex := -1;

// Vérifier quel élément est sélectionné
if ListBox1.ItemIndex >= 0 then
  ShowMessage('Sélection : ' + ListBox1.Items[ListBox1.ItemIndex]);

// Vérifier si quelque chose est sélectionné
if ListBox1.ItemIndex = -1 then
  ShowMessage('Aucune sélection');
```

#### 3. MultiSelect - Sélection multiple

Permet de sélectionner plusieurs éléments en même temps :

```pascal
ListBox1.MultiSelect := True;   // Sélection multiple activée
ListBox1.MultiSelect := False;  // Sélection simple (par défaut)
```

Avec MultiSelect activé :
- **Ctrl+Clic** : Ajouter/retirer un élément de la sélection
- **Shift+Clic** : Sélectionner une plage d'éléments

#### 4. Selected - État de sélection des éléments

Pour les listes en mode MultiSelect, indique si chaque élément est sélectionné :

```pascal
// Sélectionner un élément
ListBox1.Selected[0] := True;

// Désélectionner un élément
ListBox1.Selected[2] := False;

// Vérifier si un élément est sélectionné
if ListBox1.Selected[0] then
  ShowMessage('Premier élément sélectionné');

// Parcourir tous les éléments sélectionnés
for i := 0 to ListBox1.Items.Count - 1 do
begin
  if ListBox1.Selected[i] then
    ListeSelectionnee.Add(ListBox1.Items[i]);
end;
```

#### 5. Sorted - Tri automatique

Si True, les éléments sont automatiquement triés par ordre alphabétique :

```pascal
ListBox1.Sorted := True;   // Tri alphabétique
ListBox1.Sorted := False;  // Ordre d'insertion (par défaut)
```

**Attention :** Si Sorted est True, les index peuvent changer lors de l'ajout d'éléments.

#### 6. Style - Style d'affichage

Détermine comment les éléments sont affichés :

```pascal
ListBox1.Style := lbStandard;      // Standard (texte seulement)
ListBox1.Style := lbOwnerDrawFixed; // Dessin personnalisé, hauteur fixe
ListBox1.Style := lbOwnerDrawVariable; // Dessin personnalisé, hauteur variable
```

#### 7. IntegralHeight - Hauteur intégrale

Si True, la hauteur de la liste est ajustée pour afficher des éléments complets :

```pascal
ListBox1.IntegralHeight := True;   // Pas d'éléments partiellement visibles (par défaut)
ListBox1.IntegralHeight := False;  // Hauteur exacte définie
```

#### 8. ExtendedSelect - Sélection étendue

Active la sélection avec Shift et Ctrl :

```pascal
ListBox1.ExtendedSelect := True;   // Activer (par défaut)
ListBox1.ExtendedSelect := False;  // Désactiver
```

#### 9. Columns - Affichage en colonnes

Affiche les éléments sur plusieurs colonnes :

```pascal
ListBox1.Columns := 0;  // Une seule colonne (par défaut)
ListBox1.Columns := 2;  // Deux colonnes
ListBox1.Columns := 3;  // Trois colonnes
```

### Utilisation pratique de TListBox

#### Exemple 1 : Liste simple avec sélection

```pascal
procedure TForm1.FormCreate(Sender: TObject);
begin
  // Remplir la liste
  ListBox1.Items.Clear;
  ListBox1.Items.AddStrings(['Alice', 'Bob', 'Charlie', 'Diana', 'Éric']);
  ListBox1.Sorted := True;
  ListBox1.ItemIndex := 0;  // Sélectionner le premier
end;

procedure TForm1.ListBox1Click(Sender: TObject);
begin
  if ListBox1.ItemIndex >= 0 then
    LabelSelection.Caption := 'Vous avez sélectionné : ' +
                              ListBox1.Items[ListBox1.ItemIndex];
end;
```

#### Exemple 2 : Sélection multiple et traitement

```pascal
procedure TForm1.FormCreate(Sender: TObject);
begin
  ListBox1.Items.AddStrings(['PDF', 'Word', 'Excel', 'PowerPoint', 'HTML']);
  ListBox1.MultiSelect := True;
  ListBox1.ExtendedSelect := True;
end;

procedure TForm1.ButtonExporterClick(Sender: TObject);
var
  i: Integer;
  Formats: TStringList;
begin
  Formats := TStringList.Create;
  try
    // Collecter tous les formats sélectionnés
    for i := 0 to ListBox1.Items.Count - 1 do
    begin
      if ListBox1.Selected[i] then
        Formats.Add(ListBox1.Items[i]);
    end;

    if Formats.Count = 0 then
    begin
      ShowMessage('Veuillez sélectionner au moins un format');
      Exit;
    end;

    // Afficher les formats sélectionnés
    ShowMessage('Formats sélectionnés : ' + Formats.CommaText);
  finally
    Formats.Free;
  end;
end;
```

#### Exemple 3 : Recherche et filtrage

```pascal
var
  ListeComplete: TStringList;

procedure TForm1.FormCreate(Sender: TObject);
begin
  // Garder une copie de la liste complète
  ListeComplete := TStringList.Create;
  ListeComplete.AddStrings(['Alice Martin', 'Bob Dupont', 'Charlie Bernard',
                            'Diana Petit', 'Éric Durand', 'Fanny Moreau']);

  // Afficher toute la liste
  ListBox1.Items.Assign(ListeComplete);
end;

procedure TForm1.EditRechercheChange(Sender: TObject);
var
  i: Integer;
  TexteRecherche: string;
begin
  TexteRecherche := LowerCase(Trim(EditRecherche.Text));

  ListBox1.Items.Clear;

  if TexteRecherche = '' then
    // Afficher tout
    ListBox1.Items.Assign(ListeComplete)
  else
  begin
    // Filtrer
    for i := 0 to ListeComplete.Count - 1 do
    begin
      if Pos(TexteRecherche, LowerCase(ListeComplete[i])) > 0 then
        ListBox1.Items.Add(ListeComplete[i]);
    end;
  end;
end;

procedure TForm1.FormDestroy(Sender: TObject);
begin
  ListeComplete.Free;
end;
```

#### Exemple 4 : Déplacer des éléments entre deux listes

```pascal
procedure TForm1.ButtonAjouterClick(Sender: TObject);
var
  i: Integer;
begin
  // Déplacer les éléments sélectionnés de ListBox1 vers ListBox2
  for i := ListBox1.Items.Count - 1 downto 0 do
  begin
    if ListBox1.Selected[i] then
    begin
      ListBox2.Items.Add(ListBox1.Items[i]);
      ListBox1.Items.Delete(i);
    end;
  end;
end;

procedure TForm1.ButtonRetirerClick(Sender: TObject);
var
  i: Integer;
begin
  // Déplacer les éléments sélectionnés de ListBox2 vers ListBox1
  for i := ListBox2.Items.Count - 1 downto 0 do
  begin
    if ListBox2.Selected[i] then
    begin
      ListBox1.Items.Add(ListBox2.Items[i]);
      ListBox2.Items.Delete(i);
    end;
  end;
end;

procedure TForm1.ButtonToutAjouterClick(Sender: TObject);
begin
  // Déplacer tout de ListBox1 vers ListBox2
  ListBox2.Items.AddStrings(ListBox1.Items);
  ListBox1.Items.Clear;
end;

procedure TForm1.ButtonToutRetirerClick(Sender: TObject);
begin
  // Déplacer tout de ListBox2 vers ListBox1
  ListBox1.Items.AddStrings(ListBox2.Items);
  ListBox2.Items.Clear;
end;
```

#### Exemple 5 : Associer des objets aux éléments

```pascal
type
  TClient = class
    ID: Integer;
    Nom: string;
    Email: string;
    constructor Create(AID: Integer; const ANom, AEmail: string);
  end;

constructor TClient.Create(AID: Integer; const ANom, AEmail: string);
begin
  ID := AID;
  Nom := ANom;
  Email := AEmail;
end;

procedure TForm1.FormCreate(Sender: TObject);
var
  Client: TClient;
begin
  // Ajouter des clients avec objets associés
  Client := TClient.Create(1, 'Alice Martin', 'alice@example.com');
  ListBox1.Items.AddObject(Client.Nom, Client);

  Client := TClient.Create(2, 'Bob Dupont', 'bob@example.com');
  ListBox1.Items.AddObject(Client.Nom, Client);

  Client := TClient.Create(3, 'Charlie Bernard', 'charlie@example.com');
  ListBox1.Items.AddObject(Client.Nom, Client);
end;

procedure TForm1.ListBox1Click(Sender: TObject);
var
  Client: TClient;
begin
  if ListBox1.ItemIndex >= 0 then
  begin
    Client := TClient(ListBox1.Items.Objects[ListBox1.ItemIndex]);
    MemoDetails.Lines.Clear;
    MemoDetails.Lines.Add('ID : ' + IntToStr(Client.ID));
    MemoDetails.Lines.Add('Nom : ' + Client.Nom);
    MemoDetails.Lines.Add('Email : ' + Client.Email);
  end;
end;

procedure TForm1.FormDestroy(Sender: TObject);
var
  i: Integer;
begin
  // Libérer tous les objets associés
  for i := 0 to ListBox1.Items.Count - 1 do
    ListBox1.Items.Objects[i].Free;
end;
```

### Événements importants de TListBox

**OnClick** : Déclenché quand l'utilisateur clique sur un élément

```pascal
procedure TForm1.ListBox1Click(Sender: TObject);
begin
  // Traiter la sélection
end;
```

**OnDblClick** : Déclenché lors d'un double-clic

```pascal
procedure TForm1.ListBox1DblClick(Sender: TObject);
begin
  if ListBox1.ItemIndex >= 0 then
    OuvrirDetail(ListBox1.Items[ListBox1.ItemIndex]);
end;
```

**OnKeyDown** : Déclenché quand une touche est pressée

```pascal
procedure TForm1.ListBox1KeyDown(Sender: TObject; var Key: Word;
                                  Shift: TShiftState);
begin
  if Key = VK_DELETE then
  begin
    if ListBox1.ItemIndex >= 0 then
      ListBox1.Items.Delete(ListBox1.ItemIndex);
  end;
end;
```

### Astuces pour TListBox

#### 1. Désélectionner tout

```pascal
ListBox1.ItemIndex := -1;  // Sélection simple

// Pour MultiSelect
for i := 0 to ListBox1.Items.Count - 1 do
  ListBox1.Selected[i] := False;
```

#### 2. Sélectionner tout (MultiSelect)

```pascal
procedure TForm1.SelectionnerTout;
var
  i: Integer;
begin
  for i := 0 to ListBox1.Items.Count - 1 do
    ListBox1.Selected[i] := True;
end;
```

#### 3. Compter les éléments sélectionnés

```pascal
function TForm1.NombreSelections: Integer;
var
  i: Integer;
begin
  Result := 0;
  for i := 0 to ListBox1.Items.Count - 1 do
  begin
    if ListBox1.Selected[i] then
      Inc(Result);
  end;
end;
```

#### 4. Éviter le scintillement lors de mises à jour

```pascal
ListBox1.Items.BeginUpdate;
try
  ListBox1.Items.Clear;
  // Ajouter beaucoup d'éléments
  for i := 0 to 10000 do
    ListBox1.Items.Add('Élément ' + IntToStr(i));
finally
  ListBox1.Items.EndUpdate;
end;
```

## Le composant TCheckListBox (Liste avec cases à cocher)

### Qu'est-ce qu'un TCheckListBox ?

**TCheckListBox** est une liste où chaque élément possède une **case à cocher**. C'est idéal pour permettre la sélection multiple d'options de manière visuelle.

**Utilisations courantes :**
- Sélectionner plusieurs options dans une liste
- Activer/désactiver plusieurs fonctionnalités
- Choisir des colonnes à afficher
- Sélectionner des filtres

### Où trouver TCheckListBox ?

TCheckListBox se trouve dans l'onglet **Additional** de la palette de composants.

### Propriétés essentielles de TCheckListBox

TCheckListBox hérite de toutes les propriétés de TListBox, avec en plus :

#### 1. Checked - État des cases

Indique si la case d'un élément est cochée :

```pascal
// Cocher un élément
CheckListBox1.Checked[0] := True;

// Décocher un élément
CheckListBox1.Checked[2] := False;

// Vérifier si un élément est coché
if CheckListBox1.Checked[0] then
  ShowMessage('Premier élément coché');
```

#### 2. State - État à trois valeurs

Comme TCheckBox, peut avoir trois états :

```pascal
CheckListBox1.State[0] := cbUnchecked;  // Décoché
CheckListBox1.State[0] := cbChecked;    // Coché
CheckListBox1.State[0] := cbGrayed;     // Indéterminé
```

#### 3. AllowGrayed - Autoriser l'état grisé

```pascal
CheckListBox1.AllowGrayed := True;   // Trois états possibles
CheckListBox1.AllowGrayed := False;  // Deux états seulement (par défaut)
```

### Utilisation pratique de TCheckListBox

#### Exemple 1 : Sélection de colonnes à afficher

```pascal
procedure TForm1.FormCreate(Sender: TObject);
begin
  CheckListBox1.Items.AddStrings(['Nom', 'Prénom', 'Email', 'Téléphone', 'Adresse']);

  // Cocher les colonnes affichées par défaut
  CheckListBox1.Checked[0] := True;  // Nom
  CheckListBox1.Checked[1] := True;  // Prénom
  CheckListBox1.Checked[2] := True;  // Email
end;

procedure TForm1.ButtonAppliquerClick(Sender: TObject);
var
  i: Integer;
begin
  // Afficher les colonnes sélectionnées
  StringGrid1.ColCount := 0;

  for i := 0 to CheckListBox1.Items.Count - 1 do
  begin
    if CheckListBox1.Checked[i] then
    begin
      StringGrid1.ColCount := StringGrid1.ColCount + 1;
      StringGrid1.Cells[StringGrid1.ColCount - 1, 0] := CheckListBox1.Items[i];
    end;
  end;
end;
```

#### Exemple 2 : Filtres de recherche

```pascal
procedure TForm1.FormCreate(Sender: TObject);
begin
  CheckListBoxFiltres.Items.AddStrings(['Documents', 'Images', 'Vidéos', 'Audio']);

  // Tous cochés par défaut
  for i := 0 to CheckListBoxFiltres.Items.Count - 1 do
    CheckListBoxFiltres.Checked[i] := True;
end;

procedure TForm1.CheckListBoxFiltresClickCheck(Sender: TObject);
begin
  // Mettre à jour la recherche quand un filtre change
  AppliquerFiltres;
end;

procedure TForm1.AppliquerFiltres;
var
  i: Integer;
  FiltresActifs: TStringList;
begin
  FiltresActifs := TStringList.Create;
  try
    for i := 0 to CheckListBoxFiltres.Items.Count - 1 do
    begin
      if CheckListBoxFiltres.Checked[i] then
        FiltresActifs.Add(CheckListBoxFiltres.Items[i]);
    end;

    RechercherAvecFiltres(FiltresActifs);
  finally
    FiltresActifs.Free;
  end;
end;
```

#### Exemple 3 : Tout cocher / Tout décocher

```pascal
procedure TForm1.ButtonToutCocherClick(Sender: TObject);
var
  i: Integer;
begin
  for i := 0 to CheckListBox1.Items.Count - 1 do
    CheckListBox1.Checked[i] := True;
end;

procedure TForm1.ButtonToutDecocherClick(Sender: TObject);
var
  i: Integer;
begin
  for i := 0 to CheckListBox1.Items.Count - 1 do
    CheckListBox1.Checked[i] := False;
end;

procedure TForm1.ButtonInverserClick(Sender: TObject);
var
  i: Integer;
begin
  for i := 0 to CheckListBox1.Items.Count - 1 do
    CheckListBox1.Checked[i] := not CheckListBox1.Checked[i];
end;
```

### Événements importants de TCheckListBox

**OnClickCheck** : Déclenché quand une case est cochée/décochée

```pascal
procedure TForm1.CheckListBox1ClickCheck(Sender: TObject);
begin
  // Réagir au changement d'état
  MettreAJourAffichage;
end;
```

## Le composant TStringGrid (Grille de texte)

### Qu'est-ce qu'un TStringGrid ?

**TStringGrid** affiche des données sous forme de **grille** (tableau) avec des lignes et des colonnes. C'est comme un tableur simplifié intégré dans votre application.

**Utilisations courantes :**
- Afficher des données tabulaires
- Créer des feuilles de calcul simples
- Afficher des résultats de requêtes
- Tableaux de saisie

### Où trouver TStringGrid ?

TStringGrid se trouve dans l'onglet **Additional** de la palette de composants.

### Propriétés essentielles de TStringGrid

#### 1. Cells - Contenu des cellules

Permet d'accéder au contenu de chaque cellule :

```pascal
// Définir le contenu d'une cellule
StringGrid1.Cells[0, 0] := 'Nom';      // Colonne 0, Ligne 0
StringGrid1.Cells[1, 0] := 'Prénom';   // Colonne 1, Ligne 0
StringGrid1.Cells[0, 1] := 'Dupont';   // Colonne 0, Ligne 1

// Lire le contenu
Valeur := StringGrid1.Cells[0, 1];
```

**Note :** Les indices commencent à 0.

#### 2. ColCount et RowCount - Nombre de colonnes et lignes

```pascal
StringGrid1.ColCount := 5;   // 5 colonnes
StringGrid1.RowCount := 10;  // 10 lignes
```

#### 3. FixedCols et FixedRows - Lignes/colonnes fixes

Les lignes et colonnes fixes ne défilent pas et sont affichées différemment :

```pascal
StringGrid1.FixedCols := 1;   // Première colonne fixe
StringGrid1.FixedRows := 1;   // Première ligne fixe (en-têtes)
```

#### 4. ColWidths et RowHeights - Largeurs et hauteurs

```pascal
// Définir la largeur d'une colonne
StringGrid1.ColWidths[0] := 150;
StringGrid1.ColWidths[1] := 100;

// Définir la hauteur d'une ligne
StringGrid1.RowHeights[0] := 30;
```

#### 5. Options - Options de comportement

Ensemble d'options pour contrôler le comportement :

```pascal
StringGrid1.Options := [goFixedVertLine, goFixedHorzLine, goVertLine,
                        goHorzLine, goRangeSelect, goDrawFocusSelected,
                        goRowSizing, goColSizing, goEditing];
```

**Options courantes :**
- `goFixedVertLine` : Lignes verticales dans les zones fixes
- `goFixedHorzLine` : Lignes horizontales dans les zones fixes
- `goVertLine` : Lignes verticales
- `goHorzLine` : Lignes horizontales
- `goRangeSelect` : Sélection de plages
- `goDrawFocusSelected` : Mettre en surbrillance la sélection
- `goRowSizing` : Redimensionner les lignes
- `goColSizing` : Redimensionner les colonnes
- `goEditing` : Permettre l'édition
- `goAlwaysShowEditor` : Toujours afficher l'éditeur
- `goRowSelect` : Sélectionner toute la ligne

#### 6. ScrollBars - Barres de défilement

```pascal
StringGrid1.ScrollBars := ssNone;       // Aucune
StringGrid1.ScrollBars := ssHorizontal; // Horizontale
StringGrid1.ScrollBars := ssVertical;   // Verticale
StringGrid1.ScrollBars := ssBoth;       // Les deux (par défaut)
```

#### 7. DefaultColWidth et DefaultRowHeight

```pascal
StringGrid1.DefaultColWidth := 100;  // Largeur par défaut
StringGrid1.DefaultRowHeight := 24;  // Hauteur par défaut
```

### Utilisation pratique de TStringGrid

#### Exemple 1 : Tableau de données simple

```pascal
procedure TForm1.FormCreate(Sender: TObject);
var
  i: Integer;
begin
  // Configuration de la grille
  StringGrid1.ColCount := 4;
  StringGrid1.RowCount := 6;
  StringGrid1.FixedRows := 1;
  StringGrid1.FixedCols := 0;

  // En-têtes
  StringGrid1.Cells[0, 0] := 'Nom';
  StringGrid1.Cells[1, 0] := 'Prénom';
  StringGrid1.Cells[2, 0] := 'Age';
  StringGrid1.Cells[3, 0] := 'Ville';

  // Données
  StringGrid1.Cells[0, 1] := 'Dupont';
  StringGrid1.Cells[1, 1] := 'Jean';
  StringGrid1.Cells[2, 1] := '35';
  StringGrid1.Cells[3, 1] := 'Paris';

  StringGrid1.Cells[0, 2] := 'Martin';
  StringGrid1.Cells[1, 2] := 'Marie';
  StringGrid1.Cells[2, 2] := '28';
  StringGrid1.Cells[3, 2] := 'Lyon';

  // Ajuster les largeurs
  StringGrid1.ColWidths[0] := 120;
  StringGrid1.ColWidths[1] := 120;
  StringGrid1.ColWidths[2] := 60;
  StringGrid1.ColWidths[3] := 120;
end;
```

#### Exemple 2 : Remplir depuis une liste

```pascal
procedure TForm1.RemplirGrille(Liste: TStringList);
var
  i, j: Integer;
  Ligne: TStringList;
begin
  Ligne := TStringList.Create;
  try
    StringGrid1.RowCount := Liste.Count + 1;  // +1 pour l'en-tête

    for i := 0 to Liste.Count - 1 do
    begin
      Ligne.CommaText := Liste[i];
      for j := 0 to Ligne.Count - 1 do
      begin
        StringGrid1.Cells[j, i + 1] := Ligne[j];
      end;
    end;
  finally
    Ligne.Free;
  end;
end;
```

#### Exemple 3 : Grille éditable avec validation

```pascal
procedure TForm1.StringGrid1SetEditText(Sender: TObject; ACol, ARow: Integer;
  const Value: string);
begin
  // Valider la saisie
  if ACol = 2 then  // Colonne Age
  begin
    try
      StrToInt(Value);  // Vérifier que c'est un nombre
    except
      ShowMessage('L''âge doit être un nombre');
      StringGrid1.Cells[ACol, ARow] := '';
    end;
  end;
end;

procedure TForm1.StringGrid1SelectCell(Sender: TObject; ACol, ARow: Integer;
  var CanSelect: Boolean);
begin
  // Afficher les détails de la ligne sélectionnée
  if ARow > 0 then
  begin
    MemoDetails.Lines.Clear;
    MemoDetails.Lines.Add('Nom : ' + StringGrid1.Cells[0, ARow]);
    MemoDetails.Lines.Add('Prénom : ' + StringGrid1.Cells[1, ARow]);
    MemoDetails.Lines.Add('Age : ' + StringGrid1.Cells[2, ARow]);
    MemoDetails.Lines.Add('Ville : ' + StringGrid1.Cells[3, ARow]);
  end;
end;
```

#### Exemple 4 : Ajouter et supprimer des lignes

```pascal
procedure TForm1.ButtonAjouterLigneClick(Sender: TObject);
begin
  StringGrid1.RowCount := StringGrid1.RowCount + 1;
  // La nouvelle ligne est vide
end;

procedure TForm1.ButtonSupprimerLigneClick(Sender: TObject);
var
  i, j: Integer;
  Ligne: Integer;
begin
  Ligne := StringGrid1.Row;

  if Ligne < StringGrid1.FixedRows then
  begin
    ShowMessage('Impossible de supprimer l''en-tête');
    Exit;
  end;

  // Décaler toutes les lignes vers le haut
  for i := Ligne to StringGrid1.RowCount - 2 do
  begin
    for j := 0 to StringGrid1.ColCount - 1 do
    begin
      StringGrid1.Cells[j, i] := StringGrid1.Cells[j, i + 1];
    end;
  end;

  // Réduire le nombre de lignes
  StringGrid1.RowCount := StringGrid1.RowCount - 1;
end;
```

#### Exemple 5 : Exporter vers CSV

```pascal
procedure TForm1.ExporterVersCSV(const NomFichier: string);
var
  i, j: Integer;
  Ligne: string;
  Fichier: TextFile;
begin
  AssignFile(Fichier, NomFichier);
  try
    Rewrite(Fichier);

    // Exporter toutes les lignes
    for i := 0 to StringGrid1.RowCount - 1 do
    begin
      Ligne := '';
      for j := 0 to StringGrid1.ColCount - 1 do
      begin
        if j > 0 then
          Ligne := Ligne + ',';
        Ligne := Ligne + StringGrid1.Cells[j, i];
      end;
      Writeln(Fichier, Ligne);
    end;
  finally
    CloseFile(Fichier);
  end;
end;
```

### Événements importants de TStringGrid

**OnSelectCell** : Déclenché quand une cellule est sélectionnée

```pascal
procedure TForm1.StringGrid1SelectCell(Sender: TObject; ACol, ARow: Integer;
  var CanSelect: Boolean);
begin
  // CanSelect = False pour empêcher la sélection
end;
```

**OnDrawCell** : Permet de dessiner personnalisé dans les cellules

```pascal
procedure TForm1.StringGrid1DrawCell(Sender: TObject; ACol, ARow: Integer;
  Rect: TRect; State: TGridDrawState);
begin
  // Personnaliser l'affichage
  if ARow > 0 then
  begin
    if StrToIntDef(StringGrid1.Cells[2, ARow], 0) < 30 then
    begin
      StringGrid1.Canvas.Brush.Color := clYellow;
      StringGrid1.Canvas.FillRect(Rect);
    end;
  end;

  // Dessiner le texte
  StringGrid1.Canvas.TextOut(Rect.Left + 2, Rect.Top + 2,
                             StringGrid1.Cells[ACol, ARow]);
end;
```

## Le composant TListView (Liste avancée)

### Qu'est-ce qu'un TListView ?

**TListView** est un composant avancé qui affiche des listes avec plusieurs **modes de visualisation** (icônes, liste, détails). C'est le composant utilisé dans l'Explorateur Windows.

**Utilisations courantes :**
- Afficher des fichiers et dossiers
- Listes de produits avec détails
- Catalogues
- Tout ce qui nécessite plusieurs vues

### Où trouver TListView ?

TListView se trouve dans l'onglet **Win32** de la palette de composants.

### Propriétés essentielles de TListView

#### 1. ViewStyle - Style de vue

Détermine comment les éléments sont affichés :

```pascal
ListView1.ViewStyle := vsIcon;      // Grandes icônes
ListView1.ViewStyle := vsSmallIcon; // Petites icônes
ListView1.ViewStyle := vsList;      // Liste
ListView1.ViewStyle := vsReport;    // Détails (avec colonnes)
```

#### 2. Items - Les éléments

Collection d'éléments à afficher :

```pascal
var
  Item: TListItem;
begin
  // Ajouter un élément
  Item := ListView1.Items.Add;
  Item.Caption := 'Document.txt';
  Item.SubItems.Add('10 Ko');
  Item.SubItems.Add('12/10/2024');
end;
```

#### 3. Columns - Les colonnes (mode Report)

Définit les colonnes en mode détails :

```pascal
procedure TForm1.FormCreate(Sender: TObject);
var
  Col: TListColumn;
begin
  ListView1.ViewStyle := vsReport;

  // Colonne Nom
  Col := ListView1.Columns.Add;
  Col.Caption := 'Nom';
  Col.Width := 200;

  // Colonne Taille
  Col := ListView1.Columns.Add;
  Col.Caption := 'Taille';
  Col.Width := 100;

  // Colonne Date
  Col := ListView1.Columns.Add;
  Col.Caption := 'Date';
  Col.Width := 120;
end;
```

#### 4. MultiSelect - Sélection multiple

```pascal
ListView1.MultiSelect := True;   // Sélection multiple
ListView1.MultiSelect := False;  // Sélection simple
```

#### 5. GridLines - Lignes de grille

Affiche des lignes de grille en mode Report :

```pascal
ListView1.GridLines := True;   // Avec lignes
ListView1.GridLines := False;  // Sans lignes
```

#### 6. RowSelect - Sélection de ligne complète

```pascal
ListView1.RowSelect := True;   // Sélectionne toute la ligne
ListView1.RowSelect := False;  // Sélectionne seulement la première colonne
```

### Utilisation pratique de TListView

#### Exemple 1 : Liste de fichiers

```pascal
procedure TForm1.FormCreate(Sender: TObject);
var
  SearchRec: TSearchRec;
  Item: TListItem;
begin
  // Configuration
  ListView1.ViewStyle := vsReport;
  ListView1.GridLines := True;
  ListView1.RowSelect := True;

  // Colonnes
  with ListView1.Columns.Add do
  begin
    Caption := 'Nom';
    Width := 200;
  end;

  with ListView1.Columns.Add do
  begin
    Caption := 'Taille';
    Width := 100;
  end;

  with ListView1.Columns.Add do
  begin
    Caption := 'Date';
    Width := 120;
  end;

  // Lister les fichiers
  if FindFirst('C:\Windows\*.exe', faAnyFile, SearchRec) = 0 then
  begin
    repeat
      Item := ListView1.Items.Add;
      Item.Caption := SearchRec.Name;
      Item.SubItems.Add(FormatFloat('#,##0', SearchRec.Size) + ' octets');
      Item.SubItems.Add(DateTimeToStr(FileDateToDateTime(SearchRec.Time)));
    until FindNext(SearchRec) <> 0;
    FindClose(SearchRec);
  end;
end;
```

#### Exemple 2 : Changer de vue

```pascal
procedure TForm1.ButtonIconesClick(Sender: TObject);
begin
  ListView1.ViewStyle := vsIcon;
end;

procedure TForm1.ButtonListeClick(Sender: TObject);
begin
  ListView1.ViewStyle := vsList;
end;

procedure TForm1.ButtonDetailsClick(Sender: TObject);
begin
  ListView1.ViewStyle := vsReport;
end;
```

#### Exemple 3 : Tri des colonnes

```pascal
procedure TForm1.ListView1ColumnClick(Sender: TObject; Column: TListColumn);
begin
  // Trier par la colonne cliquée
  ListView1.SortType := stText;
  ListView1.Column[Column.Index].Tag := 1 - ListView1.Column[Column.Index].Tag;

  if ListView1.Column[Column.Index].Tag = 0 then
    ListView1.Sorted := True  // Croissant
  else
    ListView1.Sorted := False; // Décroissant
end;
```

## Bonnes pratiques pour les listes et grilles

### 1. Optimisation des performances

```pascal
// Désactiver le rafraîchissement pendant le remplissage
ListView1.Items.BeginUpdate;
try
  // Ajouter beaucoup d'éléments
  for i := 0 to 10000 do
    AjouterElement(i);
finally
  ListView1.Items.EndUpdate;
end;
```

### 2. Libération de la mémoire

```pascal
// Toujours libérer les objets associés
for i := 0 to ListBox1.Items.Count - 1 do
begin
  if Assigned(ListBox1.Items.Objects[i]) then
    ListBox1.Items.Objects[i].Free;
end;
```

### 3. Validation de la sélection

```pascal
if ListBox1.ItemIndex >= 0 then
  // Traiter
else
  ShowMessage('Veuillez sélectionner un élément');
```

### 4. Interface responsive

```pascal
// Afficher une barre de progression pour les opérations longues
ProgressBar1.Max := ListView1.Items.Count;
for i := 0 to ListView1.Items.Count - 1 do
begin
  TraiterElement(i);
  ProgressBar1.Position := i + 1;
  Application.ProcessMessages;  // Garder l'interface réactive
end;
```

### 5. Recherche efficace

```pascal
// Utiliser IndexOf pour rechercher
Index := ListBox1.Items.IndexOf('Texte recherché');
if Index >= 0 then
  ListBox1.ItemIndex := Index;
```

## Tableau comparatif

| Composant | Avantage | Utilisation typique |
|-----------|----------|---------------------|
| TListBox | Simple et rapide | Listes simples |
| TCheckListBox | Cases à cocher intégrées | Sélections multiples visuelles |
| TStringGrid | Tableau structuré | Données tabulaires |
| TListView | Vues multiples | Fichiers, catalogues |

## Conclusion

Les composants de listes et de grilles sont essentiels pour afficher et manipuler des collections de données dans vos applications. Chacun a ses forces et ses cas d'usage spécifiques.

**Points clés à retenir :**

**TListBox :**
- Simple et efficace pour des listes d'éléments
- Support de la sélection simple ou multiple
- Peut associer des objets aux éléments
- Idéal pour des listes simples

**TCheckListBox :**
- Cases à cocher intégrées
- Parfait pour sélectionner plusieurs options
- Tout cocher/décocher facilement
- Excellent pour les filtres et options

**TStringGrid :**
- Affichage tabulaire de données
- Édition de cellules
- Lignes et colonnes fixes
- Idéal pour les tableaux de données

**TListView :**
- Vues multiples (icônes, liste, détails)
- Colonnes avec tri
- Interface style Explorateur Windows
- Parfait pour les fichiers et catalogues

En maîtrisant ces composants, vous pouvez créer des interfaces riches et interactives pour afficher et manipuler efficacement toutes sortes de collections de données dans vos applications Delphi.

Dans la prochaine section, nous explorerons les contrôles avancés comme PageControl, TreeView et autres composants sophistiqués pour créer des interfaces encore plus complexes.

⏭️ [Contrôles avancés (PageControl, TreeView, ListView)](/04-conception-dinterfaces-utilisateur-avec-la-vcl/04-controles-avances.md)
