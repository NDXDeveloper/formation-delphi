# 19.1.1 Conception de la base de donn√©es

üîù Retour √† la [Table des mati√®res](/SOMMAIRE.md)

La conception d'une base de donn√©es solide est la fondation de toute application de gestion performante. Dans cette section, nous allons cr√©er ensemble le mod√®le de donn√©es pour notre application de gestion de commerce, en nous assurant qu'il soit √† la fois complet et √©volutif.

## Comprendre les besoins m√©tier

Avant de cr√©er des tables et des relations, prenons le temps de comprendre les besoins m√©tier de notre application :

- **Gestion des produits** : stockage des informations sur les articles vendus
- **Suivi des stocks** : quantit√©s disponibles et mouvements d'inventaire
- **Gestion des clients** : informations et historique des achats
- **Suivi des commandes** : commandes pass√©es, leur statut et leur contenu
- **Gestion des fournisseurs** : coordonn√©es et produits fournis
- **Statistiques de vente** : donn√©es pour analyser les performances

## Mod√®le entit√©-relation (MER)

Voici le mod√®le entit√©-relation que nous allons impl√©menter :

![Mod√®le entit√©-relation](https://via.placeholder.com/800x600)

Notre base de donn√©es comprendra les tables principales suivantes :

1. **Produits** : catalogue des articles vendus
2. **Cat√©gories** : classement des produits
3. **Clients** : informations sur les acheteurs
4. **Commandes** : ent√™tes des commandes clients
5. **LignesCommande** : d√©tails des produits dans chaque commande
6. **Fournisseurs** : informations sur les fournisseurs
7. **Stock** : √©tat des stocks pour chaque produit
8. **MouvementStock** : historique des entr√©es/sorties
9. **Utilisateurs** : employ√©s utilisant l'application
10. **Roles** : niveaux d'acc√®s des utilisateurs

## Description d√©taill√©e des tables

### Table `Produits`

Cette table stocke tous les produits commercialis√©s :

| Champ | Type | Description | Cl√© |
|-------|------|-------------|-----|
| ProductID | INT | Identifiant unique | PK |
| Reference | VARCHAR(20) | R√©f√©rence du produit | |
| Designation | VARCHAR(100) | Nom du produit | |
| Description | TEXT | Description d√©taill√©e | |
| PrixAchat | DECIMAL(10,2) | Prix d'achat HT | |
| PrixVente | DECIMAL(10,2) | Prix de vente HT | |
| TVA | DECIMAL(5,2) | Taux de TVA applicable | |
| CategoryID | INT | Cat√©gorie du produit | FK |
| FournisseurID | INT | Fournisseur principal | FK |
| PhotoURL | VARCHAR(255) | Chemin vers l'image | |
| DateCreation | DATETIME | Date d'ajout au catalogue | |
| Actif | BOOLEAN | Produit actif ou archiv√© | |

### Table `Categories`

Organisation hi√©rarchique des produits :

| Champ | Type | Description | Cl√© |
|-------|------|-------------|-----|
| CategoryID | INT | Identifiant unique | PK |
| NomCategorie | VARCHAR(50) | Nom de la cat√©gorie | |
| Description | TEXT | Description | |
| ParentCategoryID | INT | Cat√©gorie parente (pour sous-cat√©gories) | FK |

### Table `Clients`

Informations sur les clients :

| Champ | Type | Description | Cl√© |
|-------|------|-------------|-----|
| ClientID | INT | Identifiant unique | PK |
| Nom | VARCHAR(50) | Nom de famille | |
| Prenom | VARCHAR(50) | Pr√©nom | |
| Societe | VARCHAR(100) | Nom de l'entreprise | |
| Email | VARCHAR(100) | Adresse email | |
| Telephone | VARCHAR(20) | Num√©ro de t√©l√©phone | |
| Adresse | VARCHAR(255) | Adresse postale | |
| CodePostal | VARCHAR(10) | Code postal | |
| Ville | VARCHAR(50) | Ville | |
| Pays | VARCHAR(50) | Pays | |
| DateCreation | DATETIME | Date d'ajout du client | |
| Commentaires | TEXT | Notes sur le client | |

### Table `Commandes`

Ent√™tes des commandes clients :

| Champ | Type | Description | Cl√© |
|-------|------|-------------|-----|
| CommandeID | INT | Identifiant unique | PK |
| Reference | VARCHAR(20) | Num√©ro de commande | |
| ClientID | INT | Client ayant pass√© la commande | FK |
| DateCommande | DATETIME | Date de cr√©ation | |
| DateLivraison | DATETIME | Date de livraison pr√©vue | |
| Statut | ENUM | 'En attente', 'Valid√©e', 'Exp√©di√©e', 'Livr√©e', 'Annul√©e' | |
| MontantHT | DECIMAL(10,2) | Montant total hors taxes | |
| MontantTTC | DECIMAL(10,2) | Montant total TTC | |
| FraisPort | DECIMAL(10,2) | Frais de livraison | |
| AdresseLivraison | TEXT | Adresse de livraison | |
| UtilisateurID | INT | Vendeur responsable | FK |
| ModePaiement | VARCHAR(50) | Mode de paiement utilis√© | |
| Commentaires | TEXT | Notes sur la commande | |

### Table `LignesCommande`

D√©tails des produits dans chaque commande :

| Champ | Type | Description | Cl√© |
|-------|------|-------------|-----|
| LigneID | INT | Identifiant unique | PK |
| CommandeID | INT | R√©f√©rence √† la commande | FK |
| ProduitID | INT | Produit command√© | FK |
| Quantite | INT | Nombre d'unit√©s | |
| PrixUnitaire | DECIMAL(10,2) | Prix unitaire au moment de la vente | |
| Remise | DECIMAL(5,2) | Remise appliqu√©e (%) | |
| MontantHT | DECIMAL(10,2) | Montant ligne hors taxes | |
| TauxTVA | DECIMAL(5,2) | Taux TVA au moment de la vente | |

Les autres tables suivent le m√™me principe et seront d√©taill√©es dans le script SQL complet.

## Script SQL de cr√©ation

Voici le script SQL qui permet de cr√©er notre base de donn√©es. Vous pouvez l'ex√©cuter directement dans MySQL Workbench ou un autre outil de gestion MySQL/MariaDB :

```sql
-- Cr√©ation de la base de donn√©es
CREATE DATABASE IF NOT EXISTS GestionCommerce DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE GestionCommerce;

-- Table des cat√©gories
CREATE TABLE Categories (
    CategoryID INT AUTO_INCREMENT PRIMARY KEY,
    NomCategorie VARCHAR(50) NOT NULL,
    Description TEXT,
    ParentCategoryID INT,
    FOREIGN KEY (ParentCategoryID) REFERENCES Categories(CategoryID) ON DELETE SET NULL
);

-- Table des fournisseurs
CREATE TABLE Fournisseurs (
    FournisseurID INT AUTO_INCREMENT PRIMARY KEY,
    RaisonSociale VARCHAR(100) NOT NULL,
    Contact VARCHAR(100),
    Email VARCHAR(100),
    Telephone VARCHAR(20),
    Adresse VARCHAR(255),
    CodePostal VARCHAR(10),
    Ville VARCHAR(50),
    Pays VARCHAR(50) DEFAULT 'France',
    SIRET VARCHAR(20),
    DateCreation DATETIME DEFAULT CURRENT_TIMESTAMP,
    Commentaires TEXT
);

-- Table des produits
CREATE TABLE Produits (
    ProduitID INT AUTO_INCREMENT PRIMARY KEY,
    Reference VARCHAR(20) NOT NULL,
    Designation VARCHAR(100) NOT NULL,
    Description TEXT,
    PrixAchat DECIMAL(10,2) NOT NULL,
    PrixVente DECIMAL(10,2) NOT NULL,
    TVA DECIMAL(5,2) DEFAULT 20.00,
    CategoryID INT,
    FournisseurID INT,
    PhotoURL VARCHAR(255),
    DateCreation DATETIME DEFAULT CURRENT_TIMESTAMP,
    Actif BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (CategoryID) REFERENCES Categories(CategoryID) ON DELETE SET NULL,
    FOREIGN KEY (FournisseurID) REFERENCES Fournisseurs(FournisseurID) ON DELETE SET NULL,
    UNIQUE (Reference)
);

-- Table des stocks
CREATE TABLE Stock (
    StockID INT AUTO_INCREMENT PRIMARY KEY,
    ProduitID INT NOT NULL,
    QuantiteDisponible INT NOT NULL DEFAULT 0,
    StockMinimum INT DEFAULT 5,
    Emplacement VARCHAR(50),
    DerniereMiseAJour DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ProduitID) REFERENCES Produits(ProduitID) ON DELETE CASCADE
);

-- Reste du script pour les autres tables...
```

Le script complet est disponible dans le fichier `database_creation.sql` inclus dans le dossier `Database` du projet.

## Cr√©ation et initialisation de la base de donn√©es

Suivez ces √©tapes pour mettre en place votre base de donn√©es :

1. **Installez MySQL/MariaDB** si ce n'est pas d√©j√† fait
2. **Cr√©ez un utilisateur d√©di√©** pour votre application
3. **Ex√©cutez le script SQL** fourni ci-dessus
4. **V√©rifiez la structure** cr√©√©e via un outil comme MySQL Workbench
5. **Ins√©rez des donn√©es de test** √† l'aide du script `sample_data.sql` fourni

### Cr√©ation d'un utilisateur MySQL pour l'application

Il est recommand√© de cr√©er un utilisateur sp√©cifique pour votre application plut√¥t que d'utiliser le compte root :

```sql
CREATE USER 'app_gestion'@'localhost' IDENTIFIED BY 'mot_de_passe_securise';
GRANT ALL PRIVILEGES ON GestionCommerce.* TO 'app_gestion'@'localhost';
FLUSH PRIVILEGES;
```

## Bonnes pratiques de conception

Voici quelques conseils pour une conception efficace :

- **Normalisez vos donn√©es** : √©vitez la redondance (jusqu'√† la 3√®me forme normale)
- **Utilisez les types appropri√©s** : INT pour les identifiants, DECIMAL pour les montants...
- **Cr√©ez des index** sur les colonnes fr√©quemment recherch√©es
- **D√©finissez des contraintes** (cl√©s √©trang√®res, unicit√©, etc.)
- **Documentez votre sch√©ma** pour r√©f√©rence future
- **Pr√©voyez l'√©volution** de votre base de donn√©es

## Manipulation de la base de donn√©es avec MySQL Workbench

MySQL Workbench est un outil graphique qui facilite la gestion de votre base de donn√©es :

1. Lancez MySQL Workbench et connectez-vous √† votre serveur
2. Cr√©ez un nouveau sch√©ma nomm√© "GestionCommerce"
3. Importez le script SQL via File > Open SQL Script
4. Ex√©cutez le script avec l'ic√¥ne d'√©clair
5. V√©rifiez que toutes les tables ont √©t√© cr√©√©es correctement

![MySQL Workbench](https://via.placeholder.com/600x400)

## Prochaines √©tapes

Maintenant que notre base de donn√©es est con√ßue et cr√©√©e, nous allons pouvoir :
- Impl√©menter la couche d'acc√®s aux donn√©es dans Delphi
- Cr√©er les classes d'entit√©s correspondant √† nos tables
- D√©velopper les fonctionnalit√©s CRUD (Create, Read, Update, Delete)

Dans la section suivante (19.1.2), nous verrons comment impl√©menter les couches d'acc√®s aux donn√©es dans notre application Delphi.

## Exercices pratiques

Pour vous familiariser avec la conception de base de donn√©es :

1. Ajoutez une table `Paiements` pour suivre les paiements re√ßus pour chaque commande
2. Modifiez la table `Produits` pour ajouter un champ de dimensions ou poids pour la logistique
3. Cr√©ez une requ√™te SQL pour lister les produits dont le stock est inf√©rieur au stock minimum
4. Concevez une vue SQL qui affiche le chiffre d'affaires par cat√©gorie de produits

---

*Note : Ce mod√®le de base de donn√©es est adapt√© pour une petite √† moyenne entreprise. Pour des besoins plus complexes (multinational, inventaire multi-entrep√¥ts, etc.), des adaptations seraient n√©cessaires.*

‚è≠Ô∏è [Impl√©mentation des couches d'acc√®s](/19-projets-avances/01.2-implementation-couches-acces.md)
